---
- set_fact:
    timestamp: '{{ ansible_date_time.year }}{{ ansible_date_time.month }}{{ ansible_date_time.day }}'
- name: put selinux in permissive mode
  selinux: policy=targeted state=permissive
  when: ansible_distribution == 'Fedora'
- name: install system packages
  package: name={{ item }} state=present
  with_items:
    - direnv
    - vim-enhanced
    - gcc
    - git
    - nginx
    - tmux
    - python3-devel
    - redhat-rpm-config
  when: ansible_distribution == 'Fedora'
- name: install system packages
  apt: name={{ item }} state=present update_cache=yes
  vars:
    with_items:
      - build-essential
      - git
      - nginx
      - tmux
      - direnv
      - policycoreutils-python-utils
      - python-selinux
      - python3.6-dev
      - python3-gdbm
      - libncurses5-dev
      - libgnome2-dev
      - libgnomeui-dev
      - libgtk2.0-dev
      - libatk1.0-dev
      - libbonoboui2-dev
      - libcairo2-dev
      - libx11-dev
      - libxpm-dev
      - libxt-dev
      - lua5.1
      - liblua5.1-dev
  when: ansible_distribution == 'Debian' or ansible_distribution == 'Ubuntu'
- name: Ensure wheel group present
  group:
    name: wheel
    state: present
- name: ensure wheel group has sudo privileges
  lineinfile:
    dest: /etc/sudoers
    state: present
    regexp: "^%wheel"
    line: "%wheel ALL=(ALL) NOPASSWD:ALL"
    validate: "/usr/sbin/visudo -cf %s"
- name: add privelaged user
  user:
    name: "{{ username }}"
    groups:
      - "wheel"
- name: add authorized_keys for target_user
  authorized_key:
    key: "{{ keys }}"
    user: "{{ username }}"
