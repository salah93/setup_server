{
	"variables": {
      "do_token": "{{env `DO_TOKEN`}}",
      "base_image": "fedora-27-x64",
      "service": "sandbox",
      "snapshot_name": "{{user `service`}}-{{timestamp}}"
  },
  "builders": [
    {
      "type": "digitalocean",
      "api_token": "{{user `do_token`}}",
      "image": "{{user `base_image`}}",
      "region": "nyc1",
      "size": "s-2vcpu-4gb",
      "ssh_username": "root",
      "snapshot_name": "{{user `snapshot_name`}}",
      "snapshot_regions": [
        "nyc1"
      ]
    }
  ],
  "provisioners": [
    {
      "type": "ansible",
      "playbook_file": "../playbook.yml",
      "groups": [
        "{{user `service`}}"
      ],
      "extra_arguments": [
        "--skip-tags=user",
        "--vault-password-file=../.ansible-secret"
      ]
    }
  ],
  "post-processors": [
    {
      "type": "manifest",
      "output": "packer-manifest.json",
      "strip_path": true,
      "custom_data": {
        "service": "{{ user `service`}}",
        "snapshot_name": "{{user `snapshot_name`}}"
      }
    }
  ]
}
